{% load static %}
<link rel="stylesheet" type="text/css" href="{% static 'css/yb_settings/yourbit_settings.css' %}"/>

<div id='div-header' class="div-header">
    {% comment %} <div class="cb-panel-back" onclick="yb_2WayPage(1);"><svg class="yb-center-margin tb" xmlns="http://www.w3.org/2000/svg" height="100%" viewBox="0 -960 960 960" width="24"><path class="yb-autoFill" d="M400-80 0-480l400-400 71 71-329 329 329 329-71 71Z"/></svg></div> {% endcomment %}
    <h3 class="yb-fillWidth yb-margin-L10 yb-autoText yb-center-margin tb" onclick="yb_2WayPage(1);"></h3>
    <div class='yb-button-close' id='cb-panel-close' onclick="yb_toggle2WayContainer('orbit-setup');"><svg class="yb-center-transform all yb-icon small" xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24"><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></div>
</div>

<div class="yb-flexColumn" id="messages-info">
    <svg class="yb-autoFill yb-center-margin lr" xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px" fill="#e8eaed"><path d="M157.69-180q-23.53 0-40.61-17.08T100-237.69v-484.62q0-23.53 17.08-40.61T157.69-780h644.62q23.53 0 40.61 17.08T860-722.31v484.62q0 23.53-17.08 40.61T802.31-180H157.69ZM480-473.92 145.39-695.39v457.7q0 5.38 3.46 8.84t8.84 3.46h644.62q5.38 0 8.84-3.46t3.46-8.84v-457.7L480-473.92Zm0-47.7 325.61-212.99H155.39L480-521.62ZM145.39-695.39v-39.22V-237.69q0 5.38 3.46 8.84t8.84 3.46h-12.3v-470Z"/></svg>
    <b class="align-center yb-pHead" style="font-size: 18px; letter-spacing: 2px;">ORBIT SETUP</b>
    <p style="font-size: small; font-weight: 550; padding-left: 5px; padding-right: 5px; font-family: 'Roboto', sans-serif; text-align: center;" class="yb-autoText yb-pText">Now that we've created your orbit, let's set up some permissions.</p>
</div>

<form class="yb-fillWidth yb-vScroll yb-pText yb-margin-T10 align-center" id="account-settings-form" method="POST" action="{% url 'settings_account' %}" style="height: calc(100% - 200px); border-radius: 15px; padding-bottom: 150px;">
    {% csrf_token %}
    <section class="setting-sub-container">
        <div id="orbit-visibilty" class="yb-field-split top yb-bg-autoGray yb-autoText yb-pText">
            <p class="field-cover-label align-left" style="grid-column: 1;">Who can see this orbit?</p>
            <select name="type" id='field-cluster-type' value="now" class="yb-input-transparent right yb-autoText yb-pText yb-form-field" style="grid-column: 2;">
                <option class="yb-input-option" value="day" selected>Invite Only</option>
                <option class="yb-input-option" value="week">Friends Only</option>
                <option class="yb-input-option" value="month">Everyone</option>
            </select>
        </div>
            <div id="orbit-enable-messages" class="yb-field-split middle yb-bg-autoGray yb-pText" style="position: relative;">
                <p class="field-cover-label yb-pText yb-autoText align-left" style="grid-column: 1; font-size: auto;">Enable Messages</p>        
                <div style="position: absolute; top: 50%; transform: translateY(-50%); right: 5px; width: 45px; text-align: left;">
                    <label class="yb-switch-round" id="yb-exclude-shared" >
                        <input type="checkbox" class="checkbox notification-check" name="app_notifications" id="nts-app-notifications" {% if notification_settings.app_notifications %} checked {% endif %}>
                        <span class="slider round"></span>
                    </label>
                </div>
            </div>

            <div id="orbit-allow-posting" class="yb-field-split middle yb-bg-autoGray yb-pText" style="position: relative;">
                <p class="field-cover-label yb-pText yb-autoText align-left" style="grid-column: 1; font-size: auto;">Allow user posting to page?</p>        
                <div style="position: absolute; top: 50%; transform: translateY(-50%); right: 5px; width: 45px; text-align: left;">
                    <label class="yb-switch-round" id="yb-exclude-shared" >
                        <input type="checkbox" class="checkbox notification-check" name="app_notifications" id="nts-app-notifications" {% if notification_settings.app_notifications %} checked {% endif %}>
                        <span class="slider round"></span>
                    </label>
                </div>
            </div>

            <div id="orbit-search-visibility" class="yb-field-split middle yb-bg-autoGray yb-pText" style="position: relative;">
                <p class="field-cover-label yb-pText yb-autoText align-left" style="grid-column: 1; font-size: auto;">Show in Search</p>        
                <div style="position: absolute; top: 50%; transform: translateY(-50%); right: 5px; width: 45px; text-align: left;">
                    <label class="yb-switch-round" id="yb-exclude-shared" >
                        <input type="checkbox" class="checkbox notification-check" name="app_notifications" id="nts-app-notifications" {% if notification_settings.app_notifications %} checked {% endif %}>
                        <span class="slider round"></span>
                    </label>
                </div>
            </div>

            <div id="orbit-management" class="yb-field-split top yb-bg-autoGray yb-autoText yb-pText">
                <p class="field-cover-label align-left" style="grid-column: 1;">Who can manage this orbit?</p>
                <select name="type" id='field-cluster-type' value="me" class="yb-input-transparent right yb-autoText yb-pText yb-form-field" style="grid-column: 2;">
                    <option class="yb-input-option" value="me" selected>Just Me</option>
                    <option class="yb-input-option" value="sel">Select Members</option>
                    <option class="yb-input-option" value="fr">Friends</option>
                </select>
            </div>
            
            <div id="orbit-post-review" class="yb-field-split bottom yb-bg-autoGray yb-pText" style="position: relative;">
                <p class="field-cover-label yb-pText yb-autoText align-left" style="grid-column: 1; font-size: auto;">Require review?</p>        
                <div style="position: absolute; top: 50%; transform: translateY(-50%); right: 5px; width: 45px; text-align: left;">
                    <label class="yb-switch-round" id="yb-exclude-shared" >
                        <input type="checkbox" class="checkbox notification-check" name="app_notifications" id="nts-app-notifications" {% if notification_settings.app_notifications %} checked {% endif %}>
                        <span class="slider round"></span>
                    </label>
                </div>
            </div>
    </section>
    
    <button type="button" class="yb-button-wide bg-autoGray font-gray yb-button-halfWidth squared yb-form-save"  style="margin-top: 20px;">Continue</button>
</form>



<script>
    $(document).ready(function(){

        tw_hideLoading();

        function setupOrbit() {
            var form = $('#setup-orbit-form');
            var url = form.attr('action');
            var data = form.serialize();
            let csrf_token = getCSRF();


            tw_showLoading();
            $.ajax({
                type: 'POST',
                url: url,
                data: data,
                headers: {
                    'X-CSRFToken': csrf_token // Include CSRF token in the headers
                },
                success: function(response) {
                    if (response.success) {
                        let orbit = response.orbit;
                        showNotification(expandNotification, 'Orbit setup');
                        yb_navigateTo('core', 'customize-orbit', orbit.id);
                    } else {
                        showNotification(expandNotification, 'Error setting up orbit');
                    }
                }
            });
        }

        //Submit form
        $('#setup-orbit-form').submit(function(e){
            e.preventDefault();
            setupOrbit();
        });
    });
</script>
