{% extends "social/base.html" %}
{% load static %}

{% block content %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/personalization-new.css' %}"/>
    <h1 style="margin-top: 70px;">Personalization</h1>
    <div id="split-content-container">
        <h1 style="margin-top: 70px; margin-left: 10px;">Personalization</h1>
        <div id="container-column-1">
            <div class="dropdown-large" id="profile-images" style="background-color:{{bit_background}}">
                <h3 class="option-header" id="image-option-header">Profile Images</h3>
                <div class="sub-setting" id="profile-img-sub" style="
                display:none;
                grid-column-start: 1;
                grid-column-end: 2;
                grid-row: 2;
                position: relative;
                " >
                    
                    <!--
                        Background image upload/select from library
                            Effects
                                -Hue
                                -Brightness
                                -Saturation
                                -Blur

                        Profile image upload/select from library
                            -Alpha PNG Toggle (Enables Transparency)
                            -Border Toggle (Assists with making transparent images look more natural)
                            -Border Type: Squircle, Square, Rectangle
                            -Gif Playback (Loop/Bounce)
                    --> 
                    <form method="POST" enctype="multipart/form-data">
                        {% csrf_token %}
                        <p>Profile Picture</p>
                        {{ profile_image_form.image }}
                        <button type="submit" name="profile_image_button">Apply</button>
                    </form>
                    <form method="POST" enctype="multipart/form-data" style="margin-bottom: 10px;">
                        {% csrf_token %}
                        <p>Profile Background</p> 
                        {{ background_image_form.background_image }}
                        <button type="submit" name="background_image_button">Apply</button>
                        <br><br>                       
                        <label for="blur-radius">Blur</label>
                        <input type="range" id="blur-radius">
                        <br>
                        <label for="dim-intensity">Dim Intensity</label>
                        <input type="range" id="dim-intensity">
                        <br><br>
                        
                    </form>

                </div>
                <svg class="expand-icon" id='images-expand' xmlns="http://www.w3.org/2000/svg" height="40" width="40"><path d="m20 25.625-10-10 1.958-1.958L20 21.708l8.042-8.041 1.958 2Z"/></svg>
            </div>
            <div class="dropdown-large" id="color" style="background-color:{{bit_background}}">
                <h3 class="option-header" id="color-option-header" style="width: 100%;">Profile Colors</h3>
                <svg class="expand-icon" id="font-expand-icon" xmlns="http://www.w3.org/2000/svg" height="40" width="40"><path d="m20 25.625-10-10 1.958-1.958L20 21.708l8.042-8.041 1.958 2Z"/></svg>
                    <form id="color-sub" class="sub-setting" 
                    style="
                    display:none;
                    grid-column-start: 1;
                    grid-column-end: 2;
                    grid-row: 2;
                    position: relative;
                    " 
                    method="POST">            
                        <div style="width: 100vw; position: relative; text-align: left;">
                            <input type='checkbox' class='yb-form-checkbox' style='margin-left: 5vw;' id='toggle-colors'>
                            <label for='toggle-colors'>Use Custom Colors</label>
                        </div>
                        <br>
                        <div id='color-customizations' style='position: relative; display: none; height: 0vh; text-align: left;'>
                                            <input class="color-selector" id="accent-color-select" type="color" name='accent_color' value="{{accent_color}}">
                            <label class="color-select-label" for="accent-color-select">Accent Color</label>
                            <br>
                            <br>
                            <input class="color-selector" id="primary-color-select" type="color" name='primary_color' value="{{bit_background}}">
                            <label class="color-select-label" for="primary-color-select">Primary Color</label>
                            <br>
                            <br>
                            <input class="color-selector" id="feedback-icon-color-select" type="color" name='feedback_icon_color' value="{{feedback_icon_color}}">
                            <label class="color-select-label" for="feedback-icon-color-select">Feedback Icon Selected Color</label>
                            <br>
                            <br>
                            <input class="color-selector" id="tfont-color-select" type="color" name='title_color' value="{{title_color}}">
                            <label class="color-select-label" for="tfont-color-select">Title Color</label>
                            <br>
                            <br>
                            <input class="color-selector" id="pfont-color-select" type="color" name='text_color' value="{{text_color}}">
                            <label class="color-select-label" for="pfont-color-select" >Paragraph Font Color</label>
                            <br>
                            <br>
                            <input class="color-selector" id="icon-color-select" type="color" name='icon_color' value="{{icon_color}}">
                            <label class="color-select-label" for="icon-color-select">Icon Color</label>
                        </div>
                    </form>
                    <!--
                        Bit background color
                            -Alpha
                            -Blur
                            -Shadow Toggle
                        Accent color
                        Icon colors
                        Panel Options (Header/Menu)
                            -Hue
                            -Filter Toggle
                            -Background Opacity
                    -->
            </div>

            <div class="dropdown-large" id="bit-layouts" style="background-color:{{bit_background}}">
                <h3 class="option-header">Customize Bits</h3>
                <svg class="expand-icon" id="font-expand-icon" xmlns="http://www.w3.org/2000/svg" height="40" width="40"><path d="m20 25.625-10-10 1.958-1.958L20 21.708l8.042-8.041 1.958 2Z"/></svg>
                <div id="sub-setting">
                    <label class="color-select-label" for="pfont-color-select" >Paragraph Font Color</label>
                    <input class="color-selector" id="pfont-color-select" type="color" value="{{text_color}}">
                    <input type="text" name="yb-align-text" list="yb-alignments">
                    <datalist id="yb-alignments">
                        <option value="left">
                        <option value="center">
                        <option value="right">
                    </datalist>

                </div>
                

            </div> 
            <div class="dropdown-large" id="fonts" style="background-color:{{bit_background}}">
                <h3 class="option-header">Custom Fonts</h3>
                <svg class="expand-icon" id="font-expand-icon" xmlns="http://www.w3.org/2000/svg" height="40" width="40"><path d="m20 25.625-10-10 1.958-1.958L20 21.708l8.042-8.041 1.958 2Z"/></svg>
                <div id="sub-setting">

                <!--
                    Title Font
                        Type
                        Size
                        Color
                        Weight
                        Border
                    Paragraph Font
                        Type
                        Size
                        Color
                        Weight
                        Border
                -->
                </div>
            </div>
        </div>
        <div id="container-column-2">
            
            <!--Profile page preview container for desktop-->
            <div id="preview">
                <img id="preview-background-img" style="-webkit-filter: brightness(80%) blur(30px);" {% if user.profile.custom.background_image %} src = "{{ user.profile.custom.background_image.url }}" {% endif %}>
                <div id="mini-head" style='backdrop-filter: brightness(200%);'>

                </div>
                <div id="mini-content">
                    <div id="mini-profile-header">
                       <img id="mini-user-image" style="border:2px solid; border-color: {{accent_color}};" src="{{ user_image }}"/>
                        <p id="mini-user-name">
                            Austin Chaney
                        </p>
                    </div>
                    <hr width="100%" style="position: relative;">
                    <div id="mini-bit1" style="background-color: {{ bit_background }};" class="mini-bit">
                        <div id="mini-user-info"></div>
                        <div id="mini-title">Title Preview</div>
                        <div id="mini-paragraph" style="color:{{text_color}}">This is a paragraph preview, it is a preview of paragraph text in paragraphs.</div>
                        
                        <div class="mini-feedback">
                            <div id="like-circle" style="background-color:{{accent_color}}"></div>
                        </div>
                    </div>
                    <br>  
                </div>
            </div>
            
            <!--Dynamic Preview Window for Mobile-->
            <div id='preview-area'>
                <div id='accent-color-preview' class='profile-image-preview'>
                    <img class='profile-image-preview-image' id='profile-image-preview-image2' src="{{user_image.url}}">
                </div>
                <div id='bit-colors-preview' class='bit-preview' style='background-color: #4b4b4b; display: none;'>
                    <div id='bit-user-info'>
                        <div id='bit-profile-image'>
                            <img id = 'bit-profile-image-image_preview.setAttribute' src=''> 
                        </div>
                        <p id='preview-name'><strong>{{user.first_name}} {{user.last_name}}</strong></p>
                        <p id='preview-username'>@{{user.username}}</p>
                    </div>

                    
                    <h3 id='preview-title' style='width: 100%;'><hr>Test<hr></h3>
                    
                    <p id='preview-paragraph'>This a test sentence for preview purposes</p>
                    <div id='preview-feedback-container'>
                        <div class='preview-feedback-button' id='button1'></div>
                        <div class='preview-feedback-button' id='button2'></div>
                        <div class='preview-feedback-button' id='button3'></div>
                        <div class='preview-feedback-button' id='button4'></div>
                        <div class='preview-feedback-button' id='button5'></div>
                    </div>
                    
                </div>
                <div id='icon-color-preview' style='display:none;'>
                    <div id='space-icon-grid'>
                        <div class='space-icon-preview-active' id='space-icon-1'>
                            <svg class="space-button-image"xmlns="http://www.w3.org/2000/svg" height="24" width="24"><path id='icon-image-1' style="fill:{{icon_color}}" d="M5.35 17.9q-2.45 0-4.175-1.725-1.725-1.725-1.725-4.2 0-2.45 1.713-4.188Q2.875 6.05 5.35 6.05q1 0 1.937.325Q8.225 6.7 8.95 7.4l1.525 1.475L8.5 10.65 7.15 9.4q-.375-.35-.838-.525Q5.85 8.7 5.35 8.7q-1.35 0-2.3.962-.95.963-.95 2.338 0 1.35.95 2.3.95.95 2.3.95.5 0 .962-.175.463-.175.838-.525l7.9-7.15q.725-.7 1.663-1.025.937-.325 1.937-.325 2.45 0 4.175 1.725Q24.55 9.5 24.55 11.95q0 2.475-1.713 4.212Q21.125 17.9 18.65 17.9q-1 0-1.937-.325-.938-.325-1.663-1.025l-1.525-1.425 2-1.8 1.325 1.225q.375.35.838.525.462.175.962.175 1.35 0 2.3-.963.95-.962.95-2.337 0-1.35-.95-2.3-.95-.95-2.3-.95-.5 0-.962.175-.463.175-.838.525l-7.9 7.15q-.725.7-1.663 1.025-.937.325-1.937.325Z"/></svg>
                        </div>
                        <div class='space-icon-preview' id='space-icon-2'>
                            <svg class="space-button-image" xmlns="http://www.w3.org/2000/svg" height="24" width="24"><path id='icon-image-2' style="fill:{{icon_color}}" d="M3 18v-2h12v2Zm0-5v-2h18v2Zm0-5V6h18v2Z"/></svg>
                        </div>
                        <div class='space-icon-preview' id='space-icon-3'>
                            <svg class="space-button-image" xmlns="http://www.w3.org/2000/svg" height="24" width="24"><path id='icon-image-3' style="fill:{{icon_color}}" d="m9.15 17.15 8-5.15-8-5.15ZM12 22.8q-2.25 0-4.213-.85-1.962-.85-3.424-2.312Q2.9 18.175 2.05 16.212 1.2 14.25 1.2 12t.85-4.225Q2.9 5.8 4.363 4.338q1.462-1.463 3.424-2.301Q9.75 1.2 12 1.2t4.225.837q1.975.838 3.438 2.301 1.462 1.462 2.299 3.437Q22.8 9.75 22.8 12q0 2.25-.838 4.212-.837 1.963-2.299 3.426Q18.2 21.1 16.225 21.95q-1.975.85-4.225.85Zm0-2.65q3.425 0 5.788-2.363Q20.15 15.425 20.15 12t-2.362-5.788Q15.425 3.85 12 3.85q-3.425 0-5.787 2.362Q3.85 8.575 3.85 12q0 3.425 2.363 5.787Q8.575 20.15 12 20.15ZM12 12Z"/></svg>
                        </div>
                        <div class='space-icon-preview' id='space-icon-4'>
                            <svg class="space-button-image" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path id='icon-image-4' style="fill:{{icon_color}}" d="M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-4.86 8.86l-3 3.87L9 13.14 6 17h12l-3.86-5.14z"/></svg>
                        </div>
                    </div>
                    <div id='profile-icon-grid'>
                        <div class='profile-icon-preview' id='profile-icon-1'>
                            <svg class="profile-interact-icon" xmlns="http://www.w3.org/2000/svg" height="24" width="24"><path id='icon-image-5' style="fill:{{profile.bit_background}};" d="M5 19h1.4l8.625-8.625-1.4-1.4L5 17.6ZM19.3 8.925l-4.25-4.2 1.4-1.4q.575-.575 1.413-.575.837 0 1.412.575l1.4 1.4q.575.575.6 1.388.025.812-.55 1.387ZM17.85 10.4 7.25 21H3v-4.25l10.6-10.6Zm-3.525-.725-.7-.7 1.4 1.4Z"/></svg>
                        </div>
                        <div class='profile-icon-preview' id='profile-icon-2'>
                            <svg name = "request_friend" data-catid="{{profile.id}}" class='profile-interact-icon' xmlns="http://www.w3.org/2000/svg" height="24" width="24"><path id='icon-image-6' style="fill:black" d="M18 14v-3h-3V9h3V6h2v3h3v2h-3v3Zm-9-2q-1.65 0-2.825-1.175Q5 9.65 5 8q0-1.65 1.175-2.825Q7.35 4 9 4q1.65 0 2.825 1.175Q13 6.35 13 8q0 1.65-1.175 2.825Q10.65 12 9 12Zm-8 8v-2.8q0-.85.438-1.563.437-.712 1.162-1.087 1.55-.775 3.15-1.163Q7.35 13 9 13t3.25.387q1.6.388 3.15 1.163.725.375 1.162 1.087Q17 16.35 17 17.2V20Zm2-2h12v-.8q0-.275-.137-.5-.138-.225-.363-.35-1.35-.675-2.725-1.013Q10.4 15 9 15t-2.775.337Q4.85 15.675 3.5 16.35q-.225.125-.362.35-.138.225-.138.5Zm6-8q.825 0 1.413-.588Q11 8.825 11 8t-.587-1.412Q9.825 6 9 6q-.825 0-1.412.588Q7 7.175 7 8t.588 1.412Q8.175 10 9 10Zm0-2Zm0 7Z"/></svg>
                        </div>
                        <div class='profile-icon-preview' id='profile-icon-3'>
                            <svg class="profile-interact-icon" xmlns="http://www.w3.org/2000/svg" height="24" width="24"><path id='icon-image-7' style="fill:{{profile.bit_background}};" d="M1 20v-4q0-.85.588-1.425Q2.175 14 3 14h3.275q.5 0 .95.25.45.25.725.675.725.975 1.788 1.525Q10.8 17 12 17q1.225 0 2.288-.55 1.062-.55 1.762-1.525.325-.425.762-.675.438-.25.913-.25H21q.85 0 1.425.575Q23 15.15 23 16v4h-7v-2.275q-.875.625-1.887.95Q13.1 19 12 19q-1.075 0-2.1-.337-1.025-.338-1.9-.963V20Zm11-4q-.95 0-1.8-.438-.85-.437-1.425-1.212-.425-.625-1.062-.987Q7.075 13 6.325 13q.55-.925 2.325-1.463Q10.425 11 12 11q1.575 0 3.35.537 1.775.538 2.325 1.463-.725 0-1.375.363-.65.362-1.075.987-.55.8-1.4 1.225Q12.975 16 12 16Zm-8-3q-1.25 0-2.125-.875T1 10q0-1.275.875-2.138Q2.75 7 4 7q1.275 0 2.138.862Q7 8.725 7 10q0 1.25-.862 2.125Q5.275 13 4 13Zm16 0q-1.25 0-2.125-.875T17 10q0-1.275.875-2.138Q18.75 7 20 7q1.275 0 2.138.862Q23 8.725 23 10q0 1.25-.862 2.125Q21.275 13 20 13Zm-8-3q-1.25 0-2.125-.875T9 7q0-1.275.875-2.138Q10.75 4 12 4q1.275 0 2.137.862Q15 5.725 15 7q0 1.25-.863 2.125Q13.275 10 12 10Z"/></svg>
                        </div>
                        <div class='profile-icon-preview' id='profile-icon-4'>
                            <svg class="profile-interact-icon" xmlns="http://www.w3.org/2000/svg" height="24" width="24"><path id='icon-image-8' style="fill:{{profile.bit_background}};" d="M4 20q-.825 0-1.412-.587Q2 18.825 2 18V6q0-.825.588-1.412Q3.175 4 4 4h16q.825 0 1.413.588Q22 5.175 22 6v12q0 .825-.587 1.413Q20.825 20 20 20Zm8-7L4 8v10h16V8Zm0-2 8-5H4ZM4 8V6v12Z"/></svg>
                        </div>
                    </div>
                </div>
                <hr>
            </div>
            <br>
            


            <div id="toggles">

                <!--Default, Default Mode (light/dark), show customizations in feed, toggle post colors-->
            </div>
                
        </div>
        <div id="mobile-spacer">

        </div>
    </div>
    <script>
        var profile_image_loaded;

        var preview_stage = 0;
        
        let image_settings = document.getElementById("image-option-header");
        let image_sub = document.getElementById("profile-img-sub");
        image_settings.addEventListener('click', function() {
            if (image_sub.style.display === 'none') {
                image_sub.style.display = "block";
                $('#images-expand').css({'transform':'rotate(180)'});
            } else {
                image_sub.style.display = "none";
            }
        });

        let color_sub = document.getElementById('color-sub')
        document.getElementById("color-option-header").addEventListener('click', function() {
            if (color_sub.style.display === 'none') {
                color_sub.style.display = "grid";
            } else {
                color_sub.style.display = "none";
            }
        });

        let profile_bkd_field = document.getElementById('bkd-image-field');
        profile_bkd_field.addEventListener("change", function() {
            let image_preview = document.getElementById('preview-background-img');
            const image_loaded = this.files[0];
            if (image_loaded) {
                const reader = new FileReader();

                reader.addEventListener('load', function() {
                    image_preview.setAttribute('src', this.result);
                });

                reader.readAsDataURL(image_loaded);

            }
        });

        let profile_img_field = document.getElementById('profile-image-field');
        profile_img_field.addEventListener("change", function() {
            let user_image_preview = document.getElementById('mini-user-image');
            const image_loaded = this.files[0];
            if (image_loaded) {
                const reader = new FileReader();

                reader.addEventListener('load', function() {
                    user_image_preview.setAttribute('src', this.result);
                });

                reader.readAsDataURL(image_loaded);

            }
        });

        $('#toggle-colors').change(function() {
            let color_option = document.getElementById('color-customizations');
            if ( color_option.style.display === 'none') {
                $('#color-customizations').show();
                $('#color-customizations').animate({'height': '35vh'}, 'slow');
            }
            else {
                $('#color-customizations').animate({'height': '0vh'}, 'slow');
                $('#color-customizations').hide();
            }
        });

        
        const primary_color_field = document.getElementById('primary-color-select')
        primary_color_field.addEventListener("change", function() {
            let bit_background = document.getElementById('bit-colors-preview');
            bit_background.style.backgroundColor = this.value;
        });

        const accent_color_field = document.getElementById('accent-color-select')
        accent_color_field.addEventListener("change", function() {
            let border1 = document.getElementById('accent-color-preview');
            let border2 = document.getElementById('bit-profile-image');
            border1.style.borderColor = this.value;
            border2.style.borderColor = this.value;
        });

        const feedback_icon_field = document.getElementById('feedback-icon-color-select');
        feedback_icon_field.addEventListener('change', function() {
            let feedback_preview1 = document.getElementById('button1').style.backgroundColor = this.value;
            let feedback_preview2 = document.getElementById('button2').style.backgroundColor = this.value;
            let feedback_preview3 = document.getElementById('button3').style.backgroundColor = this.value;
            let feedback_preview4 = document.getElementById('button4').style.backgroundColor = this.value;
            let feedback_preview5 = document.getElementById('button5').style.backgroundColor = this.value;
            
        });

        
        const icon_field = document.getElementById('icon-color-select');
        icon_field.addEventListener('change', function() {
            let space_icon1 = document.getElementById('icon-image-1').style.fill = this.value;
            let space_icon2 = document.getElementById('icon-image-2').style.fill = this.value;
            let space_icon3 = document.getElementById('icon-image-3').style.fill = this.value;
            let space_icon4 = document.getElementById('icon-image-4').style.fill = this.value;
            let space_icon5 = document.getElementById('icon-image-5').style.fill = this.value;
            let space_icon6 = document.getElementById('icon-image-6').style.fill = this.value;
            let space_icon7 = document.getElementById('icon-image-7').style.fill = this.value;
            let space_icon8 = document.getElementById('icon-image-8').style.fill = this.value;
            
        });

        const text_color_field = document.getElementById('pfont-color-select');
        text_color_field.addEventListener('change', function() {
            let text_color_preview = document.getElementById('preview-paragraph');
            text_color_preview.style.color = this.value;
        });

        const title_color_field = document.getElementById('tfont-color-select');
        title_color_field.addEventListener('change', function() {
            let title_color_preview = document.getElementById('preview-title');
            title_color_preview.style.color = this.value;
        });

        accent_color_field.addEventListener('click', function() {
            if (preview_stage === 1) {
                $('#bit-colors-preview').fadeOut();
                $('#accent-color-preview').fadeIn();
            }
            if (preview_stage === 2) {
                $('#icon-color-preview').fadeOut();
                $('#accent-color-preview').fadeIn();
            }

            preview_stage = 0
        });

        icon_field.addEventListener('click', function() {
            if (preview_stage === 0) {
                $('#accent-color-preview').fadeOut();
                $('#icon-color-preview').fadeIn();
            }
            if (preview_stage === 1) {
                $('#bit-colors-preview').fadeOut();
                $('#icon-color-preview').fadeIn();
            }
            preview_stage = 2
        });

        title_color_field.addEventListener('click', function() {
            if (preview_stage === 0) {
                $('#accent-color-preview').fadeOut();
                $('#bit-colors-preview').fadeIn();
            }
            if (preview_stage === 2) {
                $('#icon-color-preview').fadeOut();
                $('#bit-colors-preview').fadeIn();
            }
            preview_stage = 1
        });

        text_color_field.addEventListener('click', function() {
            if (preview_stage === 0) {
                $('#accent-color-preview').fadeOut();
                $('#bit-colors-preview').fadeIn();
            }
            if (preview_stage === 2) {
                $('#icon-color-preview').fadeOut();
                $('#bit-colors-preview').fadeIn();
            }
            preview_stage = 1
        });

        feedback_icon_field.addEventListener('click', function() {
            if (preview_stage === 0) {
                $('#accent-color-preview').fadeOut();
                $('#bit-colors-preview').fadeIn();
            }
            if (preview_stage === 2) {
                $('#icon-color-preview').fadeOut();
                $('#bit-colors-preview').fadeIn();
            }
            preview_stage = 1
        });
        primary_color_field.addEventListener('click', function() {
            if (preview_stage === 0) {
                $('#accent-color-preview').fadeOut();
                $('#bit-colors-preview').fadeIn();
            }
            if (preview_stage === 2) {
                $('#icon-color-preview').fadeOut();
                $('#bit-colors-preview').fadeIn();
            }
            preview_stage = 1
        });


        </script>
{% endblock %}