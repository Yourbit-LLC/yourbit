{% extends 'social/base.html' %}
{% load static %}
{% block content %}
<link rel="stylesheet" type="text/css" href="{% static 'css/search_results.css' %}"/>
<div id="content-container">
    <form class="back-form" method="POST">
        <a type = "button" id="back-button" href="{{ last_page }}">Go back</a>
    </form>
    {% if result_count == 1 %}
        <p>Showing {{ result_count }} result for "{{ searched }}" </p>
    {% else %}
        <p>Showing {{ result_count }} results for "{{ searched }}" </p>
    {% endif %}
    {% for result in user_results %}
        <div class = "search-result" id="user-result" style="background-color: {{result.profile.bit_background}};">
            <img style="border: 3px solid {{result.profile.accent_color}};" id="result-image" src="{{ result.profile.image.url }}"/>
            <h4 class="profile-result-name">{{ result.first_name }} {{ result.last_name }}</h4>
            <p class="profile-result-username"> @{{ result.username }} </p>
            
            <p id="result-bio">
            {% if result.profile.user_bio%}
            <strong>"</strong> {{result.profile.user_bio}} <strong>"</strong>           
            {% endif %}
            </p>
            
            <a class="result-background-link" href="{% url 'profile' result.username %}"></a>
        </div>
        <br>
    {% endfor %}
    {% for bit in bit_results %}
    {% if bit.bit_type == "chat"%}
    <div class="post-wrapper" id = "chat-post-wrapper" style="background-color:{{ bit.user.profile.bit_background }}">
        <div id="chat-bit-name-date">
            <a id="chat-bit-profile-picture-link" href="{% url 'profile' bit.user.profile.pk %}"><img style="border-color: {{bit.user.profile.accent_color}};" id="chat-bit-profile-picture" src="{{bit.user.profile.image.url}}" ></a>
            <p id="chat-bit-user-info"><strong id="chat-user-name">{{bit.user.first_name}} {{bit.user.last_name}}</strong> <small>@{{bit.user.username}}</small> </p>
            <p id="chat-bit-time-label"><small>{{ bit.created_at }}</small></p>
        </div>
        {% if bit.title %}
            <div id="chat-bit-title"><h3>{{ bit.title }}<h3></div>
        {% endif %}
        <div id="comments-display{{bit.pk}}"></div>
        <div id="chat-bit-display-description"><p>{{bit.body|linebreaks|urlize}}</p></div>
        <div id="feed-bit-comment-container"></div>
        <a class="post-background-link" href="{% url 'bit-detail' bit.pk %}"></a>
        <form method='POST' id="chat-bit-feedback-container" class = "post-interaction-container" action="{% url 'interact' bit.pk %}">
            {% csrf_token %}
            <input type="hidden" name="next" value="{{ request.path }}">
            {% if bit in liked_bits %}
                <a class="feedback-icon-active" style="background-color: {{bit.user.profile.accent_color}};" name = "like" id="smiley-post-button"><img class = "post-feedback-icon" id="smiley-post-icon" src="{% static 'images/icon-smiley.png' %}"></a>
            {% else %}
                <a class="feedback-icon" name = "like" id="smiley-post-button"><img class = "post-feedback-icon" id="smiley-post-icon" src="{% static 'images/icon-smiley.png' %}"></a>
            {% endif %}
            <p id="like-count" class="counter">{{ bit.likes.all.count }}</p>
            {% if bit in disliked_bits %}
                <button type = "submit" style="background-color: {{bit.user.profile.accent_color}};" class="feedback-icon-active" name = "dislike" id="frowny-post-button"><img class = "post-feedback-icon" id="frowny-post-icon" src="{%  static 'images/icon-frowny.png' %}"></button>
            {% else %}
                <button type = "submit" class="feedback-icon" name = "dislike" id="frowny-post-button"><img class = "post-feedback-icon" id="frowny-post-icon" src="{%  static 'images/icon-frowny.png' %}"></button>
            {% endif %}
            <p id="dislike-count" class="counter">{{ bit.dislikes.all.count }}</p>
            <button type = "submit" class="feedback-icon" name = "share" id="share-post-button" href="#" data-catid="{{bit.pk}}"><img class = "post-feedback-icon" id="share-post-icon" src="{% static 'images/icon-share.png' %}"></button>
            <p id="share-count" class="counter">0</p>
            <a onclick="ShowComments('chat-comment-display-container{{bit.pk}}','comments-display-label{{bit.pk}}')" class="feedback-icon" name = "comment" id="comment-post-button" href="#" data-catid="{{bit.pk}}"><img class = "post-feedback-icon" id="comment-post-icon" src="{% static 'images/icon-comment.png' %}"></a>
            <p id="comment-count" class="counter">{{ bit.comments.all.count }}</p>
            <button type = "submit" class="feedback-icon" name = "donate" id="donate-post-button" href="#" data-catid="{{bit.pk}}"><img class = "post-feedback-icon" id="donate-post-icon" src="{% static 'images/icon-donate1.png' %}"></button>
        </form>
        <form method="POST" id="field-write-comment" action="{% url 'comment' bit.pk%}">
            {% csrf_token %}
            <input type="hidden" name="next" value="{{ request.path }}">
            {{write_comment.comment}}
            <button id="write-comment-button" type="submit">Send</button>
        </form>
        <p class = "comments-display-label" id="comments-display-label{{bit.pk}}" style="display:none;"><b>Comments:</b></p>
        <div class = "chat-comment-display-container" id="chat-comment-display-container{{bit.pk}}" style="display: none;">
            {% if bit.comments.all%}
                {% for comment in bit.comments.all|dictsortreversed:"created_on" %}
                    {% if user.id == comment.user.id %}
                            <div id="right-comment-display-wrapper">
                                <div id="chat-comment-display-right" style="background-color: {{bit.user.profile.accent_color}}">
                                    <p id="comment-text"> <strong>{{ comment.user.first_name }} {{comment.user.last_name}}</strong>: {{ comment.comment }}</p>
                                    <weak id="comment-time">{{comment.created_on}}</weak>
                                </div>
                            </div>
                        <br>
                    {% else %}
                        <div id="comment-display-left">
                            <p id="comment-text"> <strong>{{ comment.user.first_name }} {{comment.user.last_name}}</strong>: {{ comment.comment }}</p>
                            <weak id="comment-time">{{comment.created_on}}</weak>
                        </div>
                        <br>
                    {% endif %}
                {% endfor %}
            {% else %}
                <p class="no-comments">No comments</p>
            {% endif %}
        </div>
    </div>
    <br>
{% elif bit.bit_type == "photo" %}
<div class="post-wrapper" id="photo-post-wrapper" style="background-color:{{ bit.user.profile.bit_background }}">
    <div id="photo-user-name">
        <a id="photo-bit-profile-picture-link" href="{% url 'profile' bit.user.profile.pk %}"><img id="chat-bit-profile-picture" src="{{bit.user.profile.image.url}}" ></a>
        <p id="photo-user-name-text"><strong>{{bit.user.first_name}} {{bit.user.last_name}}</strong> <small>@{{bit.user.username}}</small></p>
    </div>
    <img src="{{ bit.image.url }}" width="100%" id="photobit"/>
    <div id="photo-info" style="text-align:center;">
        <h4 id="photo-title"> {{bit.title}}</h4>
        <p id="photo-caption"> {{bit.body}}</p>
    </div>                
    <form method='POST' id="chat-bit-feedback-container" class = "post-interaction-container" action="{% url 'interact' bit.pk %}">
    {% csrf_token %}
    <input type="hidden" name="next" value="{{ request.path }}">
    {% if bit in liked_bits %}
        <button type = "submit" style="background-color: {{bit.user.profile.accent_color}};" class="feedback-icon-active" name = "like" id="smiley-post-button"><img class = "post-feedback-icon" id="smiley-post-icon" src="{% static 'images/icon-smiley.png' %}"></button>
    {% else %}
        <button type = "submit" class="feedback-icon" name = "like" id="smiley-post-button"><img class = "post-feedback-icon" id="smiley-post-icon" src="{% static 'images/icon-smiley.png' %}"></button>
    {% endif %}
    <p id="like-count" class="counter">{{ bit.likes.all.count }}</p>
    {% if bit in disliked_bits %}
        <button type = "submit" class="feedback-icon-active" style="background-color: {{bit.user.profile.accent_color}};" name = "dislike" id="frowny-post-button"><img class = "post-feedback-icon" id="frowny-post-icon" src="{%  static 'images/icon-frowny.png' %}"></button>
    {% else %}
        <button type = "submit" class="feedback-icon" name = "dislike" id="frowny-post-button"><img class = "post-feedback-icon" id="frowny-post-icon" src="{%  static 'images/icon-frowny.png' %}"></button>
    {% endif %}
    <p id="dislike-count" class="counter">{{ bit.dislikes.all.count }}</p>
    <button type = "submit" class="feedback-icon" name = "share" id="share-post-button" href="#" data-catid="{{bit.pk}}"><img class = "post-feedback-icon" id="share-post-icon" src="{% static 'images/icon-share.png' %}"></button>
    <p id="share-count" class="counter">0</p>
    <button type = "submit" class="feedback-icon" name = "comment" id="comment-post-button" href="#" data-catid="{{bit.pk}}"><img class = "post-feedback-icon" id="comment-post-icon" src="{% static 'images/icon-comment.png' %}"></button>
    <p id="comment-count" class="counter">{{ bit.comments.all.count }}</p>
    <button type = "submit" class="feedback-icon" name = "donate" id="donate-post-button" href="#" data-catid="{{bit.pk}}"><img class = "post-feedback-icon" id="donate-post-icon" src="{% static 'images/icon-donate1.png' %}"></button>
</form>
<div class = "video-comment-display-container" id="video-comment-display-container{{bit.pk}}" style="display: none;">
    {% if bit.comments.all%}
        {% for comment in bit.comments.all|dictsortreversed:"created_on" %}
            {% if user.id == comment.user.id %}
                    <div id="right-comment-display-wrapper">
                        <div id="chat-comment-display-right" style="background-color: {{bit.user.profile.accent_color}};">
                            <p id="comment-text"> <strong>{{ comment.user.first_name }} {{comment.user.last_name}}</strong>: {{ comment.comment }}</p>
                            <weak id="comment-time">{{comment.created_on}}</weak>
                        </div>
                    </div>
                <br>
            {% else %}
                <div id="comment-display-left">
                    <p id="comment-text"> <strong>{{ comment.user.first_name }} {{comment.user.last_name}}</strong>: {{ comment.comment }}</p>
                    <weak id="comment-time">{{comment.created_on}}</weak>
                </div>
                <br>
            {% endif %}
        {% endfor %}
    {% else %}
        <p class="no-comments">No comments</p>
    {% endif %}
    <form method="POST" id="video-field-write-comment" action="{% url 'comment' bit.pk%}">
    {% csrf_token %}
    <input type="hidden" name="next" value="{{ request.path }}">
    {{write_comment.comment}}
    <button id="write-comment-button" type="submit">Send</button>
</form>
</div>
</div>
    <br>
{% elif bit.bit_type == "video"%}
<div class="post-wrapper" id="video-post-wrapper" style="background-color:{{ bit.user.profile.bit_background }}">
    <div id = "video-bit-name-date">
        <a id="chat-bit-profile-picture-link" href="{% url 'profile' bit.user.profile.pk %}"><img id="chat-bit-profile-picture" src="{{bit.user.profile.image.url}}" ></a>
        <p id="video-user-name"><strong>{{bit.user.first_name}} {{bit.user.last_name}}</strong> <small>@{{ bit.user.username }}</small></p>
    </div>
    <video src="{{ bit.video.url }}" width="100%" id="videobit" controls></video>              
            
    <h3 id="video-title"> {{bit.title}}</h3>
    <p onclick="ShowDescription('video-description{{bit.pk}}')" id="video-show-description-button">Show Description</p>
    <p class="video-caption" id="video-description{{bit.pk}}" style = "display: none;"> {{bit.body}}</p>

    <form method='POST' id="video-bit-feedback-container" class = "post-interaction-container" action="{% url 'interact' bit.pk %}">
        {% csrf_token %}
        <input type="hidden" name="next" value="{{ request.path }}">
        {% if bit in liked_bits %}
            <button type = "submit" style="background-color: {{bit.user.profile.accent_color}};" class="feedback-icon-active" name = "like" id="smiley-post-button"><img class = "post-feedback-icon" id="smiley-post-icon" src="{% static 'images/icon-smiley.png' %}"></button>
        {% else %}
            <button type = "submit" class="feedback-icon" name = "like" id="smiley-post-button"><img class = "post-feedback-icon" id="smiley-post-icon" src="{% static 'images/icon-smiley.png' %}"></button>
        {% endif %}
        <p id="like-count" class="counter">{{ bit.likes.all.count }}</p>
        {% if bit in disliked_bits %}
            <button type = "submit" style="background-color: {{bit.user.profile.accent_color}};" class="feedback-icon-active" name = "dislike" id="frowny-post-button"><img class = "post-feedback-icon" id="frowny-post-icon" src="{%  static 'images/icon-frowny.png' %}"></button>
        {% else %}
            <button type = "submit" class="feedback-icon" name = "dislike" id="frowny-post-button"><img class = "post-feedback-icon" id="frowny-post-icon" src="{%  static 'images/icon-frowny.png' %}"></button>
        {% endif %}
        <p id="dislike-count" class="counter">{{ bit.dislikes.all.count }}</p>
        <button type = "submit" class="feedback-icon" name = "share" id="share-post-button" href="#" data-catid="{{bit.pk}}"><img class = "post-feedback-icon" id="share-post-icon" src="{% static 'images/icon-share.png' %}"></button>
        <p id="share-count" class="counter">0</p>
        <a onclick="ShowComments('video-comment-display-container{{bit.pk}}')" class="feedback-icon" name = "comment" id="comment-post-button" href="#" data-catid="{{bit.pk}}"><img class = "post-feedback-icon" id="comment-post-icon" src="{% static 'images/icon-comment.png' %}"></a>
        <p id="comment-count" class="counter">{{ bit.comments.all.count }}</p>
        <button type = "submit" class="feedback-icon" name = "donate" id="donate-post-button" href="#" data-catid="{{bit.pk}}"><img class = "post-feedback-icon" id="donate-post-icon" src="{% static 'images/icon-donate1.png' %}"></button>
    </form>
    <div class = "video-comment-display-container" id="video-comment-display-container{{bit.pk}}" style="display: none;">
        {% if bit.comments.all%}
            {% for comment in bit.comments.all|dictsortreversed:"created_on" %}
                {% if user.id == comment.user.id %}
                        <div id="right-comment-display-wrapper">
                            <div id="chat-comment-display-right">
                                <p id="comment-text"> <strong>{{ comment.user.first_name }} {{comment.user.last_name}}</strong>: {{ comment.comment }}</p>
                                <weak id="comment-time">{{comment.created_on}}</weak>
                            </div>
                        </div>
                    <br>
                {% else %}
                    <div id="comment-display-left">
                        <p id="comment-text"> <strong>{{ comment.user.first_name }} {{comment.user.last_name}}</strong>: {{ comment.comment }}</p>
                        <weak id="comment-time">{{comment.created_on}}</weak>
                    </div>
                    <br>
                {% endif %}
            {% endfor %}
        {% else %}
            <p class="no-comments">No comments</p>
        {% endif %}
    </div>
    <form method="POST" id="video-field-write-comment" action="{% url 'comment' bit.pk%}">
        {% csrf_token %}
        <input type="hidden" name="next" value="{{ request.path }}">
        {{write_comment.comment}}
        <button id="write-comment-button" type="submit">Send</button>
    </form>
</div>

<br>

{% endif %}
{% endfor %}
</div>

    
{% endblock %}