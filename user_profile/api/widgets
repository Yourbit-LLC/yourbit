from rest_framework.decorators import api_view
from rest_framework.response import Response
from user_profile.models import *

@api_view(["POST"])
def requestFriend(request):
    from notifications.models import Notification
    from YourbitAccounts.models import Account as User
    that_id = request.data.get("this_id")
    to_user = User.objects.get(id=that_id)
    new_notification = Notification(type = 4, to_user=to_user, from_user = request.user)
    new_notification.save()
    return Response({"Response":"Added user as friend"})
    
@api_view(["POST"])
def follow(request):
    from notifications.models import Notification
    from YourbitAccounts.models import Account as User
    that_id = request.data.get("this_id")
    that_user = User.objects.get(id = that_id)

    this_profile = Profile.objects.get(user = request.user)
    that_profile = Profile.objects.get(user = that_user)

    this_profile.follows.add(that_profile)
    this_profile.save()

    that_profile.followers.add(this_profile)
    that_profile.save()
    
    new_notification = Notification(type = 3, to_user = that_user, from_user = request.user)
    new_notification.save()
    return Response({"Response":"Successfully followed user"})

@api_view(["POST"])
def updateTimezone(request):
    this_profile = Profile.objects.get(user=request.user)
    this_timezone = request.data.get("user_tz")
    print(this_timezone)
    this_profile.current_timezone = this_timezone
    this_profile.save()

    return Response({"Response":"Timezone successfully updated"})
