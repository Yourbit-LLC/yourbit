{% extends 'main/base.html' %}
{% load static %}
{% block content %}
<link rel="stylesheet" type="text/css" href="{% static 'css/messages-yourbit.css' %}"/>
<div id='content-container' style='padding-top: 185px;'>
    <div class='mobile-search-recipents-form'>
        <h4 style='margin-top: 10px; margin-bottom: 0px; margin-left: 10px; color: white;'>New Conversation</h4>
        <input type = 'text' id='mobile-searchbar-messages' class='single-line-input' placeholder='Search Users' >
        <div class='filter-options' style='
        display: grid; 
        grid-template-columns: auto auto auto auto; 
        column-gap: 4px; 
        position: relative;
        z-index: 3; 
        top: 20px; 
        margin-bottom: 10px; 
        margin-left: auto;
        margin-right: auto;
        width: 95vw; 
        border-radius: 28px;
        height: 35px; 
        backdrop-filter: blur(40px);
        -webkit-backdrop-filter: blur(40px);
        overflow: hidden;
        '>
        <button class='filter-button'>All</button>
        <button class='filter-button'>Friends</button>
        <button class='filter-button'>Followers</button>
        <button class='filter-button'>Following</button>
        
    </div>
    </div>  

    {% for connection in connections%}
        <div class='user-list-item' id="user-list-container"style="background-color: {{connection.user.profile.custom.bit_background}};"s>
            <a class='message-user-list-link' data-username="{{connection.user.username}}"></a>
            <img class="profile-image-medium" src="{{connection.user.profile.custom.image.url}}">
            <p class="list-user-name"  ><b>{{connection.user.first_name}} {{connection.user.last_name}}</b></p>
            <div class="active-status"></div>
        
        </div>
    {% endfor %}
    <div id="mobile-spacer" style='height: 200px;'>

    </div>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
<script type='text/javascript'>
    var base_url = window.location.origin;
    $('.message-user-list-link').click(function() {
        console.log('link clicked')
        let csrfToken = getCSRF();
        let username = $(this).attr('data-username');
        $.ajax( {
            type: 'POST',
            headers: {
                'X-CSRFToken': csrfToken
            },
            url: '/messages/create-conversation/',
            data: {
                username: username
            },
            success: function(data){
                let new_conversation = data
                let id = new_conversation.conversation_id
                window.location.href = `/messages/conversation/${id}`;
            }
        })
    })

</script>

{% endblock %}