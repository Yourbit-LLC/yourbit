{% load static %}
<link rel="stylesheet" type="text/css" href="{% static 'css/conversations.css' %}"/>

<div id='header' style='text-align:center; color: white;'>
    <svg id="back-to-convos" xmlns="http://www.w3.org/2000/svg" style="position: absolute; left: 15px; top: 50%; transform: translate(0, -50%);" height="24" width="24"><path d="M10 22 0 12 10 2l1.775 1.775L3.55 12l8.225 8.225Z"/></svg>
    <h3 id="receiver-name" style="margin-top:15px; margin-bottom: 2px;"></h3>
    <p style='margin-top:0px;'><small>offline</small></p>
    <svg xmlns="http://www.w3.org/2000/svg" style = "position: absolute; right: 15px; top: 50%; transform: translate(0, -50%);" height="24" width="24"><path d="M12 20q-.825 0-1.412-.587Q10 18.825 10 18q0-.825.588-1.413Q11.175 16 12 16t1.413.587Q14 17.175 14 18q0 .825-.587 1.413Q12.825 20 12 20Zm0-6q-.825 0-1.412-.588Q10 12.825 10 12t.588-1.413Q11.175 10 12 10t1.413.587Q14 11.175 14 12q0 .825-.587 1.412Q12.825 14 12 14Zm0-6q-.825 0-1.412-.588Q10 6.825 10 6t.588-1.412Q11.175 4 12 4t1.413.588Q14 5.175 14 6t-.587 1.412Q12.825 8 12 8Z"/></svg>
</div>

<div id='message-container'>
    <!--Messages are appended here-->
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
<script class="page-script" type='text/javascript' type="text/css" src="{% static 'scripts/messenger.js' %}"></script>
<script>
    $(document).ready(function(){
        let back_button = document.getElementById("back-to-convos");
        console.log("conversation loaded!")
        yb_hideUI();
        let this_id = yb_getSessionValues("conversation");

        let message_container = document.getElementById("message-container");
        let mobile_spacer = yb_createElement("div", "mobile-spacer", "mobile-spacer");
        message_container.appendChild(mobile_spacer);

        yb_getMessages(this_id);

        back_button.addEventListener("click", function() {
            console.log("Go back")
            clearInterval(yb_checkMessages);
            messages_inbox_url();
            $('.minibar').animate({"bottom": "95px"}).fadeIn();

        });

        //Get universal form container
        let universal_form = document.getElementById("universal-container-form-conversation")
        
        //Attachments button
        let attach_button = yb_createButton("add-attachment", "attach-button", "yb-button-round");
        attach_button.innerHTML = "<svg xmlns='http://www.w3.org/2000/svg' height='24' width='24'><path d='M20 6H4V4h16v2Zm0 4H4v2h16v-2Zm0 4H4v2h16v-2Zm0 4H4v2h16v-2Z'/></svg>";
        attach_button.addEventListener("click", function() {
            console.log("Attach file");
        });
        universal_form.appendChild(attach_button);

        //Input field
        let input_field = yb_createInput("text", "yb-single-line-input", "input-text-messenger", "type message");
        universal_form.appendChild(input_field);

        //Send button
        let send_button = yb_createButton("send-message", "send-button", "yb-button-round", "Send");
        send_button.addEventListener("click", function() {
            let text_field = document.getElementById("message-field")
            let this_id = yb_getSessionValues("conversation");
            let that_user = yb_getSessionValues("that-username")
            let body = text_field.value;
        
            //This ID refers to conversation id
            yb_sendMessage(body, this_id, that_user)
        });
        universal_form.appendChild(send_button);
        
        yb_showUniversalInput();





    });


</script>